services:
  gates-mcp:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: gates-mcp
    image: iccm/gates:latest
    ports:
      - "9050:8050"
    environment:
      - GATES_PORT=8050
      - GATES_HOST=0.0.0.0
      - PLAYFAIR_URL=ws://playfair-mcp:8040
      - LOG_LEVEL=info
      - NODE_ENV=production
      # File Output Configuration
      - DEFAULT_OUTPUT_DIR=/mnt/irina_storage/files/temp/gates
    volumes:
      - gates-output:/app/output
      # Mount ICCM project directory for direct file access
      - /mnt/projects/ICCM:/mnt/projects/ICCM
      # Mount Horace storage for document output
      - irina_storage_files:/mnt/irina_storage/files
    networks:
      - iccm_network
    restart: unless-stopped
    deploy:
      resources:
        limits:
          memory: 1G
          cpus: '2'
        reservations:
          memory: 512M
          cpus: '1'
    healthcheck:
      test: ["CMD", "wget", "--no-verbose", "--tries=1", "--spider", "http://127.0.0.1:8050/health"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 10s

volumes:
  gates-output:
    driver: local

  irina_storage_files:
    driver: local
    driver_opts:
      type: none
      device: /mnt/projects/ICCM/irina_storage_test/files
      o: bind

networks:
  iccm_network:
    external: true
